# Пошаговое тестирование Google Apps Script

## Проблема
При запуске `testDoPost()` получаете ошибку: "Cannot read properties of undefined (reading 'parameter')"

## Решение
Функция `doPost()` предназначена для обработки HTTP POST запросов, а не для прямого вызова в редакторе.

## Правильная последовательность тестирования:

### Шаг 1: Тестируйте доступ к таблице
1. В Google Apps Script выберите функцию `testSpreadsheet` из выпадающего списка
2. Нажмите "Выполнить"
3. Проверьте логи - должно появиться сообщение "Тест успешно завершен"
4. Проверьте Google Таблицу - должна появиться новая запись

### Шаг 2: Тестируйте doPost с данными
1. Выберите функцию `testDoPost` из выпадающего списка
2. Нажмите "Выполнить"
3. Проверьте логи - должно появиться "Результат теста: success"

### Шаг 3: Разверните веб-приложение
1. Нажмите "Развернуть" → "Новое развертывание"
2. Выберите тип "Веб-приложение"
3. Настройки:
   - Описание: "Wish-лист API"
   - Кто имеет доступ: "Все"
   - Выполнить как: "Я"
4. Нажмите "Развернуть"
5. **ВАЖНО:** Скопируйте URL веб-приложения (должен заканчиваться на `/exec`)

### Шаг 4: Обновите HTML файлы
В файлах `index.html` и `test-form.html` замените:
```javascript
const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_SCRIPT_URL_HERE';
```
На ваш реальный URL из шага 3.

### Шаг 5: Тестируйте через браузер
1. Откройте `test-form.html` в браузере
2. Заполните поля и нажмите "Отправить тест"
3. Проверьте консоль браузера (F12)
4. Проверьте Google Таблицу

### Шаг 6: Тестируйте основной сайт
1. Откройте `index.html` в браузере
2. Нажмите "Забронировать" на любом подарке
3. Заполните форму и отправьте
4. Проверьте результат

## Что проверить если не работает:

### 1. URL веб-приложения
Правильный URL должен выглядеть примерно так:
```
https://script.google.com/macros/s/XXXXXXXXX/exec
```

### 2. Разрешения
При первом развертывании Google Apps Script запросит разрешения:
- Доступ к Google Sheets
- Доступ к Gmail (для отправки уведомлений)

### 3. Логи выполнения
В Google Apps Script → "Выполнения" можно посмотреть логи всех запросов

### 4. Консоль браузера
Откройте Developer Tools (F12) и проверьте:
- Отправляются ли данные
- Есть ли ошибки CORS
- Какой приходит ответ от сервера

## Типичные ошибки:

- **"undefined parameter"** - функция вызывается напрямую, а не через HTTP
- **CORS ошибки** - используется неправильный URL или веб-приложение не развернуто
- **403 Forbidden** - недостаточно разрешений или неправильные настройки доступа
- **Пустые данные в таблице** - данные не передаются корректно из HTML

## Отладочная информация:

После успешной настройки в логах Google Apps Script должно быть:
```
Полученный объект e: {...}
e.parameter: {giftName: "...", userName: "...", ...}
Используем e.parameter: {...}
Извлеченные данные формы: {...}
```

А в Google Таблице должна появиться запись со всеми заполненными полями.
